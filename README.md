# Яндекс Практикум - Мастерская 1: Предсказание риска сердечных приступов

## Описание проекта

В этом проекте разрабатывается модель машинного обучения для предсказания риска сердечных приступов. Цель — разработать модель машинного обучения, которая способна анализировать данные пациентов и предсказывать риск сердечного приступа, а также подготовить библиотеку и интерфейс к ней для предсказания на тестовой выборке.

Проект включает:
- предобработку и анализ данных;
- разработку и обучение модели;
- сохранение модели для последующего использования;
- создание FastAPI-приложения для демонстрации работы модели и выполнения предсказаний на тестовой выборке, а также на новых данных.

---

## Результаты исследования

- Анализ данных показал, что большинство признаков имеют схожие распределения для обоих классов целевой переменной, а корреляция входных признаков с таргетом либо низкая, либо отсутствует. Это говорит о слабой разделимости классов на основе имеющихся данных.
- Вследствие этого не получилось достичь высокой точности модели. Было принято решение минимизировать ошибки второго рода (максимизировать метрику `recall`), чтобы не пропустить ни одного пациента с потенциальным риском сердечного приступа, закрыв глаза на большое количество ошибок первого рода (пожертвовав метрикой `precision`).
- Итоговая модель выдаёт вероятности и использует подобранный порог для классификации.

---

## Установка и запуск приложения

1. Клонирование репозитория

```bash
git clone https://github.com/totsamiyyoker/YP_masterskaya_1_heart_attack_risk
cd YP_masterskaya_1_heart_attack_risk
```

2. Создание и активация виртуального окружения (`venv` или `conda`). Пример для `conda`:

```bash
conda create -n heart_env python=3.13.7
conda activate heart_env
```

3. Установите зависимости:

```bash
pip install -r requirements.txt
```

Для установки библиотеки `phik` пользователям Windows лучше использовать `conda`:

```bash
conda install -c conda-forge phik
```

4. Для запуска приложения:

```bash
cd FastAPI_app
uvicorn app:app --reload --port 8010
```

---

## Использование приложения

После запуска сервиса приложение будет доступно в браузере по адресу http://127.0.0.1:8010/ или http://localhost:8010/. На этой странице будет представлен веб-интерфейс для работы с моделью.

- На странице есть форма, куда можно вставить одну строку с признаками пациента в том же формате, что и в тестовых данных (обработка признаков выполняется автоматически в приложении, а также внутри модели). После отправки формы отобразится результат — есть ли у пациента с переданным `id` риск сердечного приступа.
- Также есть возможность загрузить CSV-файл с признаками для группы пациентов (тестовая выборка или же другие данные в таком же формате). После обработки есть выбор:
    - скачать готовый CSV-файл с предсказаниями;
    - просмотреть те же предсказания в формате JSON прямо в браузере

Таким образом, приложение позволяет работать как с отдельными наблюдениями, так и с целыми наборами данных.

---

## Структура проекта

```text
C:.
│   .gitignore                  # Список файлов и папок, игнорируемых Git
│   FastAPI_docs.md             # Документация по работе FastAPI-приложения
│   README.md                   # Описание проекта, инструкции по запуску
│   requirements.txt            # Зависимости проекта
│
├───data
│   │   heart_predictions.csv   # Результаты предсказаний модели
│   │
│   └───raw                     # Исходные данные (не публикуются)
│           heart_test.csv
│           heart_train.csv
│
├───FastAPI_app                 # Приложение FastAPI
│   │   app.py                  # Основной скрипт приложения
│   │   best_pipe.pkl           # Сохранённая модель в пайплайне
│   │   model.py                # Класс Model, инкапсулирующий работу с моделью
│   │   
│   ├───templates               # HTML-шаблоны для веб-интерфейса
│   │       start_form.html
│   │       
│   ├───tmp
│   │       predictions.csv
│
└───notebooks                   # Jupyter тетрадки исследования
    │   masterskaya_heart_attack_risk.ipynb
```